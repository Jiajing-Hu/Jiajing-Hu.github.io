---
title: 内联函数与宏
date: 2018-11-29 20:00:11
tags: C/C++
catories: C/C++基础知识
---

内联函数与宏,这两者通常能够实现类似的功能,也在面试中经常放在一起比较.所以这里简单说一说内联函数和宏的区别

### 内联函数

在C/C++中,一般函数的储存是储存函数的地址.当我们调用一个函数的时候,将会跳转到相应的地址,并且在函数调用结束后返回.在执行函数的调用时,程序先储存函数的地址,然后讲函数的参数复制到栈中,执行函数的代码,最后返回调用函数除的地址.

简单地来说,在一般的函数调用的时候.内存存在两次跳转,第一次从调用点跳转到函数地址,然后在函数返回时跳回调用点.这里的来回跳转对于机器来说是需要一定的开销的,另外函数在调用的过程中使用的是函数栈,但是函数栈的大小是有限的,如果在某个时候大量的进行函数调用或者函数的递归调用,有可能导致栈空间不足使程序出错.

对于一些经常调用的**小型**函数,如果经常反复跳转的话,程序的性能将会被拖慢.所以内联函数就应运而生了.

> 在计算机科学中，内联函数（有时称作在线函数或编译时期展开函数）是一种编程语言结构，用来建议编译器对一些特殊函数进行内联扩展（有时称作在线扩展）；也就是说建议编译器将指定的函数体插入并取代每一处调用该函数的地方（上下文），从而节省了每次调用函数带来的额外时间开支。

也就是说,内联函数实在函数的原地展开,并不会设计到内存的跳转问题.这样的好处是在函数调用的时候避免了跳转带来的时间开销.但是这样牺牲了一些内存.所以我们一般规定内联函数中不允许出现循环

### 宏

宏有时候也叫宏函数,但是**宏不是函数**,它只是简单的**文本替换**

举一个十分简单的例子

```c++
# include <iostream>
using namespace std;
# define F(x) x * x
int main()
{
    cout << F(5) << endl; ---①
    cout << F(5 + 5) << endl; ---②
    return 0;
}
```
在这个程序中,①处的输出应该是5,但是②处的输出却不是100,而是35

因为F(5 + 5) = 5 + 5 * 5 + 5 = 35   --**宏只是文本的替换**

所以在使用宏函数的时候一定要注意好括号的问题


### 宏和内联函数的区别

1. 内联函数是一个**函数**,但是宏只是简单的文本替换

2. 内联函数在编译期展开,但是宏是预处理命令,所以在预编译期展开

3. 内联函数支持类型检查,但是宏不支持

4. 内联函数有返回值,宏没有返回值

5. 内联函数将会造成程序体积的增加,但是宏不会


### 一些补充

1. 宏还有其他的很多功能,作为函数只是其中的一个小功能,这里讨论的宏只是函数形式的宏

2. inline只是一个**建议**,但是编译器可以拒绝.也就是inline开头的不一定都是内联函数

3. 在class中的函数都是内联函数







